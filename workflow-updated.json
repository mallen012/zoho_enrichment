{"updatedAt":"2026-01-12T05:25:50.791Z","createdAt":"2026-01-10T18:22:25.849Z","id":"pvdUlL8oUiLlSvkD","name":"Snovio Contact Finder (Zoho Accounts)","description":null,"active":true,"isArchived":false,"nodes":[{"id":"sticky-overview","name":"Overview","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"parameters":{"content":"## Snovio Contact Finder\n\n**Endpoints:**\n- GET /snovio-search?accountId=XXX\n- POST /snovio-save\n\n**Flow:**\n1. Get Account â†’ Extract domain\n2. Snovio Domain Search (1 credit)\n3. Auto-update Account fields\n4. Display prospect popup\n5. User selects contacts\n6. Email lookup (1 credit each)\n7. Create Zoho Contacts\n\n**Branding:** Perdigon dark theme","height":400,"width":300,"color":4}},{"id":"webhook-search","name":"Webhook: Search","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[400,300],"webhookId":"snovio-search","parameters":{"httpMethod":"GET","path":"snovio-search","responseMode":"responseNode","options":{}}},{"id":"webhook-save","name":"Webhook: Save","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[400,600],"webhookId":"snovio-save","parameters":{"httpMethod":"POST","path":"snovio-save","responseMode":"responseNode","options":{}}},{"id":"config-search","name":"Config (Search)","type":"n8n-nodes-base.code","typeVersion":2,"position":[620,300],"parameters":{"jsCode":"const query = $input.first().json.query || {};\n\nconst CONFIG = {\n  SNOVIO_USER_ID: \u0027d37f94b18ce02ece5f401ce8683b258e\u0027,\n  SNOVIO_SECRET: \u002745b473e4d2f48e928c9bafd7fcbcd853\u0027,\n  ACCOUNT_ID: query.accountId || null,\n  LOGO_URL: \u0027https://raw.githubusercontent.com/mallen012/Perdigon-Directory/main/Blue%20Logo%20Only.png\u0027\n};\n\nif (!CONFIG.ACCOUNT_ID) {\n  return [{ json: { error: \u0027Missing accountId parameter\u0027, CONFIG } }];\n}\n\nreturn [{ json: CONFIG }];"}},{"id":"config-save","name":"Config (Save)","type":"n8n-nodes-base.code","typeVersion":2,"position":[620,600],"parameters":{"jsCode":"const body = $input.first().json.body || {};\n\nconst CONFIG = {\n  SNOVIO_USER_ID: \u0027d37f94b18ce02ece5f401ce8683b258e\u0027,\n  SNOVIO_SECRET: \u002745b473e4d2f48e928c9bafd7fcbcd853\u0027,\n  ACCOUNT_ID: body.accountId || null,\n  ACCOUNT_NAME: body.accountName || \u0027\u0027,\n  DOMAIN: body.domain || \u0027\u0027,\n  COMPANY_PHONE: body.companyPhone || \u0027\u0027,\n  COMPANY_WEBSITE: body.companyWebsite || \u0027\u0027,\n  SELECTED_PROSPECTS: body.prospects || [],\n  LOGO_URL: \u0027https://raw.githubusercontent.com/mallen012/Perdigon-Directory/main/Blue%20Logo%20Only.png\u0027\n};\n\nif (!CONFIG.ACCOUNT_ID || CONFIG.SELECTED_PROSPECTS.length === 0) {\n  return [{ json: { error: \u0027Missing accountId or no prospects selected\u0027, CONFIG } }];\n}\n\nreturn [{ json: CONFIG }];"}},{"id":"check-account-id","name":"Has Account ID?","type":"n8n-nodes-base.if","typeVersion":2,"position":[840,300],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.ACCOUNT_ID }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}}},{"id":"get-zoho-account","name":"Get Zoho Account","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1060,240],"parameters":{"url":"=https://www.zohoapis.com/crm/v2/Accounts/{{ $json.ACCOUNT_ID }}","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","options":{}},"credentials":{"zohoOAuth2Api":{"id":"jcm850uJVwpPyj2c","name":"Zoho ALL account"}}},{"id":"parse-account","name":"Parse Account","type":"n8n-nodes-base.code","typeVersion":2,"position":[1280,240],"parameters":{"jsCode":"const response = $input.first().json;\nconst config = $(\u0027Config (Search)\u0027).first().json;\n\nconst account = response.data?.[0];\nif (!account) {\n  return [{ json: { error: \u0027Account not found\u0027, accountId: config.ACCOUNT_ID } }];\n}\n\n// Extract domain from website\nlet domain = null;\nif (account.Website) {\n  try {\n    let url = account.Website;\n    if (!url.startsWith(\u0027http\u0027)) url = \u0027https://\u0027 + url;\n    domain = new URL(url).hostname.replace(\u0027www.\u0027, \u0027\u0027);\n  } catch (e) {\n    // Try simple extraction\n    domain = account.Website.replace(/^(https?:\\/\\/)?(www\\.)?/, \u0027\u0027).split(\u0027/\u0027)[0];\n  }\n}\n\nreturn [{ json: {\n  ...config,\n  accountId: account.id,\n  accountName: account.Account_Name || \u0027\u0027,\n  website: account.Website || null,\n  domain: domain,\n  currentPhone: account.Phone || null,\n  currentIndustry: account.Industry || null,\n  currentEmployees: account.No_of_Employees || null,\n  currentStreet: account.Billing_Street || null,\n  currentCity: account.Billing_City || null,\n  currentState: account.Billing_State || null,\n  currentZip: account.Billing_Code || null,\n  currentCountry: account.Billing_Country || null,\n  currentEmailDomain: account.Email_Domain || null\n}}];"}},{"id":"check-domain","name":"Has Domain?","type":"n8n-nodes-base.if","typeVersion":2,"position":[1500,240],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.domain }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}}},{"id":"snovio-token","name":"Snovio: Get Token","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1720,180],"parameters":{"method":"POST","url":"https://api.snov.io/v1/oauth/access_token","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ grant_type: \u0027client_credentials\u0027, client_id: $json.SNOVIO_USER_ID, client_secret: $json.SNOVIO_SECRET }) }}","options":{"response":{"response":{"responseFormat":"json"}}}}},{"id":"snovio-domain-search","name":"Snovio: Start Search","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1940,180],"parameters":{"url":"https://api.snov.io/v2/domain-search/prospects/start","method":"POST","sendBody":true,"sendHeaders":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ domain: $(\u0027Parse Account\u0027).first().json.domain }) }}","headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $(\u0027Snovio: Get Token\u0027).first().json.access_token }}"}]},"options":{"response":{"response":{"responseFormat":"json"}}}},"onError":"continueRegularOutput","alwaysOutputData":true},{"id":"parse-snovio-results","name":"Parse Snovio Results","type":"n8n-nodes-base.code","typeVersion":2,"position":[2600,180],"parameters":{"jsCode":"const snovio = $input.first().json;\nconst accountData = $(\u0027Parse Account\u0027).first().json;\n\n// Get credits balance from Snovio: Get Balance node\nconst creditsData = $(\u0027Snovio: Get Balance\u0027).first().json;\nconst creditsBalance = creditsData.balance || 0;\n\n// v2 API response: data[] is the array of prospects, meta.total_count is the total\nconst rawProspects = snovio.data || [];\nconst totalCount = snovio.meta?.total_count || rawProspects.length;\n\nconst prospects = rawProspects.map((p, idx) =\u003e {\n  // Check if Snovio already has cached email for this prospect\n  const cachedEmail = p.emails?.emails?.[0]?.email || null;\n  const cachedStatus = p.emails?.emails?.[0]?.smtp_status || null;\n\n  // Extract prospect hash from search_emails_start URL (if present)\n  const emailUrl = p.search_emails_start || \u0027\u0027;\n  const hashMatch = emailUrl.match(/start\\/([a-f0-9]+)$/);\n  const prospectHash = hashMatch ? hashMatch[1] : null;\n\n  // Determine email and status\n  let email = null;\n  let status = \u0027unknown\u0027;\n\n  if (cachedEmail) {\n    // Snovio already has the email cached - use it directly\n    email = cachedEmail;\n    status = cachedStatus || \u0027valid\u0027;\n  } else if (p.email) {\n    // Direct email field (legacy format)\n    email = p.email;\n    status = \u0027valid\u0027;\n  }\n\n  return {\n    id: prospectHash || `prospect-${idx}`,\n    firstName: p.first_name || \u0027\u0027,\n    lastName: p.last_name || \u0027\u0027,\n    fullName: `${p.first_name || \u0027\u0027} ${p.last_name || \u0027\u0027}`.trim() || \u0027Unknown\u0027,\n    position: p.position || \u0027\u0027,\n    email: email,\n    sourcePage: p.source_page || null,\n    status: status,\n    prospectHash: prospectHash,\n    emailLookupUrl: p.search_emails_start || null,\n    hasCachedEmail: !!cachedEmail\n  };\n});\n\n// Company info from Snovio meta\nconst meta = snovio.meta || {};\nconst companyInfo = {\n  companyName: meta.company_name || null,\n  website: accountData.domain,\n  logoUrl: meta.logo || null,\n  phone: meta.hq_phone || null,\n  industry: meta.industry || null,\n  city: meta.city || null,\n  state: meta.state || null,\n  country: meta.country || null,\n  street: meta.street || null,\n  postalCode: meta.postal_code || null,\n  employeeCount: meta.employee_count || null\n};\n\n// Build update fields for Account (only if currently empty in Zoho)\nconst accountUpdates = {};\n\n// Phone\nif (!accountData.currentPhone \u0026\u0026 meta.hq_phone) {\n  accountUpdates.Phone = meta.hq_phone;\n}\n\n// Industry\nif (!accountData.currentIndustry \u0026\u0026 meta.industry) {\n  accountUpdates.Industry = meta.industry;\n}\n\n// Billing Address fields\nif (!accountData.currentStreet \u0026\u0026 meta.street) {\n  accountUpdates.Billing_Street = meta.street;\n}\nif (!accountData.currentCity \u0026\u0026 meta.city) {\n  accountUpdates.Billing_City = meta.city;\n}\nif (!accountData.currentState \u0026\u0026 meta.state) {\n  accountUpdates.Billing_State = meta.state;\n}\nif (!accountData.currentZip \u0026\u0026 meta.postal_code) {\n  accountUpdates.Billing_Code = meta.postal_code;\n}\nif (!accountData.currentCountry \u0026\u0026 meta.country) {\n  accountUpdates.Billing_Country = meta.country;\n}\n\n// Employee count\nif (!accountData.currentEmployees \u0026\u0026 meta.employee_count) {\n  accountUpdates.Employees = meta.employee_count;\n}\n\n// Email Domain - add domain to account if not already set\nif (!accountData.currentEmailDomain \u0026\u0026 accountData.domain) {\n  accountUpdates.Email_Domain = accountData.domain;\n}\n\nreturn [{ json: {\n  ...accountData,\n  companyInfo,\n  prospects,\n  prospectCount: prospects.length,\n  totalCount: totalCount,\n  hasMorePages: !!snovio.links?.next,\n  accountUpdates,\n  hasUpdates: Object.keys(accountUpdates).length \u003e 0,\n  apiSuccess: snovio.status === \u0027completed\u0027 || rawProspects.length \u003e 0,\n  creditsBalance: creditsBalance\n}}];"}},{"id":"check-updates","name":"Has Account Updates?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2820,180],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.hasUpdates }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}}},{"id":"update-zoho-account","name":"Update Zoho Account","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3040,120],"parameters":{"method":"PUT","url":"=https://www.zohoapis.com/crm/v2/Accounts/{{ $json.accountId }}","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ data: [$json.accountUpdates] }) }}","options":{}},"credentials":{"zohoOAuth2Api":{"id":"jcm850uJVwpPyj2c","name":"Zoho ALL account"}},"onError":"continueRegularOutput"},{"id":"merge-to-popup","name":"Merge to Popup","type":"n8n-nodes-base.merge","typeVersion":3,"position":[3260,180],"parameters":{"mode":"append"}},{"id":"build-popup-html","name":"Build Popup HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[3480,180],"parameters":{"jsCode":"const data = $(\u0027Parse Snovio Results\u0027).first().json;\nconst prospects = data.prospects || [];\nconst accountName = data.accountName || \u0027Account\u0027;\nconst domain = data.domain || \u0027\u0027;\nconst logoUrl = data.LOGO_URL;\nconst totalInDb = data.totalCount || 0;\nconst creditsBalance = data.creditsBalance || 0;\nconst companyPhone = data.companyInfo?.phone || \u0027\u0027;\nconst companyWebsite = data.companyInfo?.website || domain;\n\nlet rows = \u0027\u0027;\nif (prospects.length === 0) {\n  rows = \u0027\u003ctr\u003e\u003ctd colspan=\"5\" style=\"text-align:center;padding:40px;color:#94a3b8;\"\u003e\u0027 +\n    (totalInDb \u003e 0 ? \u0027\u003cdiv style=\"font-size:48px;margin-bottom:16px;\"\u003eðŸ“Š\u003c/div\u003e\u003cdiv style=\"font-size:18px;margin-bottom:8px;\"\u003e\u0027 + totalInDb + \u0027 emails in Snovio database\u003c/div\u003e\u003cdiv style=\"font-size:13px;\"\u003eProspect data is being processed. Try again in a moment.\u003c/div\u003e\u0027 : \u0027No contacts found for this domain\u0027) +\n    \u0027\u003c/td\u003e\u003c/tr\u003e\u0027;\n} else {\n  prospects.forEach((p, i) =\u003e {\n    const hasEmail = p.email \u0026\u0026 p.email.length \u003e 0;\n    const rowBg = hasEmail ? \u0027rgba(100,200,120,0.15)\u0027 : \u0027rgba(255,180,80,0.15)\u0027;\n    const statusIcon = hasEmail ? \u0027âœ“\u0027 : \u0027?\u0027;\n    const statusColor = hasEmail ? \u0027#4ade80\u0027 : \u0027#fbbf24\u0027;\n    const linkedInLink = p.sourcePage\n      ? \u0027\u003ca href=\"\u0027 + p.sourcePage + \u0027\" target=\"_blank\" style=\"color:#60a5fa;text-decoration:none;\"\u003eLinkedIn ðŸ”—\u003c/a\u003e\u0027\n      : \u0027\u003cspan style=\"color:#64748b;\"\u003eâ€”\u003c/span\u003e\u0027;\n\n    rows += \u0027\u003ctr style=\"background:\u0027 + rowBg + \u0027;\"\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;text-align:center;\"\u003e\u0027 +\n        \u0027\u003cinput type=\"checkbox\" name=\"prospect\" value=\"\u0027 + p.id + \u0027\" \u0027 +\n          \u0027data-firstname=\"\u0027 + (p.firstName || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-lastname=\"\u0027 + (p.lastName || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-position=\"\u0027 + (p.position || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-email=\"\u0027 + (p.email || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-linkedin=\"\u0027 + (p.sourcePage || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-status=\"\u0027 + p.status + \u0027\" \u0027 +\n          \u0027data-hash=\"\u0027 + (p.prospectHash || \u0027\u0027) + \u0027\" \u0027 +\n          \u0027data-emaillookupurl=\"\u0027 + (p.emailLookupUrl || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027style=\"width:18px;height:18px;cursor:pointer;\"\u003e\u0027 +\n      \u0027\u003c/td\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;\"\u003e\u0027 +\n        \u0027\u003cdiv style=\"font-weight:500;\"\u003e\u0027 + p.fullName + \u0027\u003c/div\u003e\u0027 +\n        (p.email ? \u0027\u003cdiv style=\"font-size:12px;color:#94a3b8;\"\u003e\u0027 + p.email + \u0027\u003c/div\u003e\u0027 : \u0027\u003cdiv style=\"font-size:12px;color:#fbbf24;\"\u003eEmail lookup required\u003c/div\u003e\u0027) +\n      \u0027\u003c/td\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;\"\u003e\u0027 + linkedInLink + \u0027\u003c/td\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;color:#cbd5e1;\"\u003e\u0027 + (p.position || \u0027â€”\u0027) + \u0027\u003c/td\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;text-align:center;\"\u003e\u003cspan style=\"color:\u0027 + statusColor + \u0027;font-weight:bold;\"\u003e\u0027 + statusIcon + \u0027\u003c/span\u003e\u003c/td\u003e\u0027 +\n      \u0027\u003c/tr\u003e\u0027;\n  });\n}\n\nconst html = \u0027\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eSnovio Contact Finder\u003c/title\u003e\u003cstyle\u003e*{box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#1a1a2e;color:#fff;margin:0;padding:20px;min-height:100vh}.container{max-width:900px;margin:0 auto}.header{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid rgba(255,255,255,0.1)}.logo{height:40px}.header-content{flex:1}.title{font-size:24px;font-weight:600}.subtitle{color:#94a3b8;font-size:14px;margin-top:4px}.header-badges{display:flex;gap:10px;align-items:center}.credits-badge{background:linear-gradient(135deg,#10b981,#059669);padding:8px 16px;border-radius:20px;font-size:13px;font-weight:600}.db-count{background:linear-gradient(135deg,#6366f1,#8b5cf6);padding:8px 16px;border-radius:20px;font-size:13px;font-weight:600}.card{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:16px;overflow:hidden}.table-container{overflow-x:auto;max-height:500px;overflow-y:auto}table{width:100%;border-collapse:collapse}th{background:rgba(0,0,0,0.3);padding:14px 12px;text-align:left;font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;color:#94a3b8;position:sticky;top:0;z-index:10}th:first-child{text-align:center;width:50px}th:last-child{text-align:center;width:60px}tr{border-bottom:1px solid rgba(255,255,255,0.05)}tr:hover{background:rgba(255,255,255,0.05)!important}.footer{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:rgba(0,0,0,0.2)}.count{color:#94a3b8;font-size:14px}.btn{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s}.btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(99,102,241,0.4)}.btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}.legend{display:flex;gap:20px;margin-top:16px;font-size:13px;color:#94a3b8}.legend-item{display:flex;align-items:center;gap:6px}.legend-dot{width:12px;height:12px;border-radius:3px}.legend-verified{background:rgba(100,200,120,0.4)}.legend-unverified{background:rgba(255,180,80,0.4)}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"container\"\u003e\u003cdiv class=\"header\"\u003e\u003cimg src=\"\u0027 + logoUrl + \u0027\" alt=\"Perdigon\" class=\"logo\"\u003e\u003cdiv class=\"header-content\"\u003e\u003cdiv class=\"title\"\u003eSnovio Contact Finder\u003c/div\u003e\u003cdiv class=\"subtitle\"\u003e\u0027 + accountName + \u0027 â€¢ \u0027 + domain + \u0027\u003c/div\u003e\u003c/div\u003e\u003cdiv class=\"header-badges\"\u003e\u003cdiv class=\"credits-badge\"\u003eðŸ’³ \u0027 + creditsBalance.toLocaleString() + \u0027 credits\u003c/div\u003e\u0027 + (totalInDb \u003e 0 ? \u0027\u003cdiv class=\"db-count\"\u003eðŸ“Š \u0027 + totalInDb + \u0027 in database\u003c/div\u003e\u0027 : \u0027\u0027) + \u0027\u003c/div\u003e\u003c/div\u003e\u003cform id=\"contactForm\"\u003e\u003cinput type=\"hidden\" name=\"accountId\" value=\"\u0027 + data.accountId + \u0027\"\u003e\u003cinput type=\"hidden\" name=\"accountName\" value=\"\u0027 + accountName + \u0027\"\u003e\u003cinput type=\"hidden\" name=\"domain\" value=\"\u0027 + domain + \u0027\"\u003e\u003cinput type=\"hidden\" name=\"companyPhone\" value=\"\u0027 + companyPhone + \u0027\"\u003e\u003cinput type=\"hidden\" name=\"companyWebsite\" value=\"\u0027 + companyWebsite + \u0027\"\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"table-container\"\u003e\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003eSelect\u003c/th\u003e\u003cth\u003eContact\u003c/th\u003e\u003cth\u003eProfile\u003c/th\u003e\u003cth\u003ePosition\u003c/th\u003e\u003cth\u003eStatus\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u0027 + rows + \u0027\u003c/tbody\u003e\u003c/table\u003e\u003c/div\u003e\u003cdiv class=\"footer\"\u003e\u003cdiv class=\"count\"\u003e\u003cspan id=\"selectedCount\"\u003e0\u003c/span\u003e of \u0027 + prospects.length + \u0027 selected\u003c/div\u003e\u003cbutton type=\"submit\" class=\"btn\" id=\"importBtn\"\u0027 + (prospects.length === 0 ? \u0027 disabled\u0027 : \u0027\u0027) + \u0027\u003eImport Selected\u003c/button\u003e\u003c/div\u003e\u003c/div\u003e\u003c/form\u003e\u003cdiv class=\"legend\"\u003e\u003cdiv class=\"legend-item\"\u003e\u003cdiv class=\"legend-dot legend-verified\"\u003e\u003c/div\u003e\u003cspan\u003eHas Email\u003c/span\u003e\u003c/div\u003e\u003cdiv class=\"legend-item\"\u003e\u003cdiv class=\"legend-dot legend-unverified\"\u003e\u003c/div\u003e\u003cspan\u003eNeeds Email Lookup (1 credit)\u003c/span\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cscript\u003econst form=document.getElementById(\"contactForm\");const checkboxes=document.querySelectorAll(\"input[name=prospect]\");const countEl=document.getElementById(\"selectedCount\");const importBtn=document.getElementById(\"importBtn\");function updateCount(){const selected=document.querySelectorAll(\"input[name=prospect]:checked\").length;countEl.textContent=selected;importBtn.disabled=selected===0}checkboxes.forEach(cb=\u003ecb.addEventListener(\"change\",updateCount));form.addEventListener(\"submit\",async(e)=\u003e{e.preventDefault();importBtn.disabled=true;importBtn.textContent=\"Importing...\";const selected=[];document.querySelectorAll(\"input[name=prospect]:checked\").forEach(cb=\u003e{selected.push({id:cb.value,firstName:cb.dataset.firstname,lastName:cb.dataset.lastname,position:cb.dataset.position,email:cb.dataset.email||null,linkedin:cb.dataset.linkedin,status:cb.dataset.status,prospectHash:cb.dataset.hash,emailLookupUrl:cb.dataset.emaillookupurl})});try{const response=await fetch(\"https://n8n.srv1127126.hstgr.cloud/webhook/snovio-save\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({accountId:form.querySelector(\"[name=accountId]\").value,accountName:form.querySelector(\"[name=accountName]\").value,domain:form.querySelector(\"[name=domain]\").value,companyPhone:form.querySelector(\"[name=companyPhone]\").value,companyWebsite:form.querySelector(\"[name=companyWebsite]\").value,prospects:selected})});const html=await response.text();document.body.innerHTML=html}catch(err){alert(\"Error: \"+err.message);importBtn.disabled=false;importBtn.textContent=\"Import Selected\"}})\u003c/script\u003e\u003c/body\u003e\u003c/html\u003e\u0027;\n\nreturn [{ json: { html, prospectCount: prospects.length } }];"}},{"id":"respond-popup","name":"Respond: Popup","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[3700,180],"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"respond-no-domain","name":"Respond: No Domain","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1720,360],"parameters":{"respondWith":"text","responseBody":"=\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eNo Website\u003c/title\u003e\u003cstyle\u003ebody{font-family:sans-serif;background:#1a1a2e;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}.card{background:rgba(255,255,255,0.1);border-radius:20px;padding:40px;text-align:center;max-width:500px}.icon{font-size:64px;margin-bottom:20px}h1{color:#f87171}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"icon\"\u003eðŸŒ\u003c/div\u003e\u003ch1\u003eNo Website Found\u003c/h1\u003e\u003cp\u003eThis Account doesn\u0027t have a Website field populated.\u003c/p\u003e\u003cp style=\"color:#94a3b8;margin-top:20px;\"\u003eAdd a website URL to the Account, then try again.\u003c/p\u003e\u003c/div\u003e\u003c/body\u003e\u003c/html\u003e","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"respond-error","name":"Respond: Error","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[840,440],"parameters":{"respondWith":"text","responseBody":"=\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eError\u003c/title\u003e\u003cstyle\u003ebody{font-family:sans-serif;background:#1a1a2e;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}.card{background:rgba(255,255,255,0.1);border-radius:20px;padding:40px;text-align:center;max-width:500px}.icon{font-size:64px;margin-bottom:20px}h1{color:#f87171}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"icon\"\u003eâš ï¸\u003c/div\u003e\u003ch1\u003eMissing Account ID\u003c/h1\u003e\u003cp\u003eNo accountId parameter was provided.\u003c/p\u003e\u003c/div\u003e\u003c/body\u003e\u003c/html\u003e","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"check-save-data","name":"Has Save Data?","type":"n8n-nodes-base.if","typeVersion":2,"position":[840,600],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.ACCOUNT_ID }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}},{"leftValue":"={{ $json.SELECTED_PROSPECTS.length }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}}},{"id":"snovio-token-save","name":"Snovio: Get Token (Save)","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1060,540],"parameters":{"method":"POST","url":"https://api.snov.io/v1/oauth/access_token","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ grant_type: \u0027client_credentials\u0027, client_id: $(\u0027Config (Save)\u0027).first().json.SNOVIO_USER_ID, client_secret: $(\u0027Config (Save)\u0027).first().json.SNOVIO_SECRET }) }}","options":{"response":{"response":{"responseFormat":"json"}}}}},{"id":"prepare-prospects","name":"Prepare Prospects","type":"n8n-nodes-base.code","typeVersion":2,"position":[1280,540],"parameters":{"jsCode":"const config = $(\u0027Config (Save)\u0027).first().json;\nconst token = $input.first().json.access_token;\n\nreturn config.SELECTED_PROSPECTS.map(p =\u003e ({\n  json: {\n    ...p,\n    accountId: config.ACCOUNT_ID,\n    accountName: config.ACCOUNT_NAME,\n    domain: config.DOMAIN,\n    companyPhone: config.COMPANY_PHONE,\n    companyWebsite: config.COMPANY_WEBSITE,\n    accessToken: token\n  }\n}));"}},{"id":"loop-prospects","name":"Loop Prospects","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1500,540],"parameters":{"options":{}}},{"id":"snovio-email-finder","name":"Snovio: Start Email Lookup","type":"n8n-nodes-base.code","typeVersion":2,"position":[1720,540],"parameters":{"jsCode":"// Get prospect data from Loop Prospects\nconst prospect = $input.first().json;\nconst { firstName, lastName, domain, emailLookupUrl, accessToken, email } = prospect;\n\n// FIRST: Check if we already have a valid email (from Snovio cached data)\nif (email \u0026\u0026 email !== null \u0026\u0026 email.includes(\u0027@\u0027)) {\n  // Email already exists - pass it through without any API call\n  return [{ \n    json: { \n      ...prospect,\n      lookupMethod: \u0027cached\u0027,\n      email: email,\n      status: \u0027valid\u0027\n    } \n  }];\n}\n\n// Check if we have a valid emailLookupUrl\nif (emailLookupUrl \u0026\u0026 emailLookupUrl.startsWith(\u0027http\u0027)) {\n  // Use the existing emailLookupUrl (from domain search)\n  try {\n    const response = await this.helpers.httpRequest({\n      method: \u0027POST\u0027,\n      url: emailLookupUrl,\n      headers: {\n        \u0027Authorization\u0027: `Bearer ${accessToken}`,\n        \u0027Content-Type\u0027: \u0027application/json\u0027\n      }\n    });\n    return [{ json: { ...response, lookupMethod: \u0027emailLookupUrl\u0027 } }];\n  } catch (error) {\n    return [{ json: { error: error.message, lookupMethod: \u0027emailLookupUrl\u0027 } }];\n  }\n} else {\n  // Use Snovio Email Finder API (add-names-to-find-emails)\n  // Must manually encode as form-urlencoded string\n  try {\n    const formBody = `access_token=${encodeURIComponent(accessToken)}\u0026first_name=${encodeURIComponent(firstName)}\u0026last_name=${encodeURIComponent(lastName)}\u0026domain=${encodeURIComponent(domain)}`;\n    \n    const response = await this.helpers.httpRequest({\n      method: \u0027POST\u0027,\n      url: \u0027https://api.snov.io/v1/add-names-to-find-emails\u0027,\n      headers: {\n        \u0027Content-Type\u0027: \u0027application/x-www-form-urlencoded\u0027\n      },\n      body: formBody\n    });\n    \n    // Parse the response if it\u0027s a string\n    let parsed = response;\n    if (typeof response === \u0027string\u0027) {\n      try {\n        parsed = JSON.parse(response);\n      } catch (e) {\n        // Keep as string if not valid JSON\n      }\n    }\n    \n    // Return with metadata for next step\n    return [{ \n      json: { \n        ...parsed,\n        lookupMethod: \u0027emailFinder\u0027,\n        firstName,\n        lastName,\n        domain,\n        accessToken\n      } \n    }];\n  } catch (error) {\n    return [{ json: { error: error.message, lookupMethod: \u0027emailFinder\u0027 } }];\n  }\n}"},"onError":"continueRegularOutput","alwaysOutputData":true},{"id":"parse-email-result","name":"Parse Email Result","type":"n8n-nodes-base.code","typeVersion":2,"position":[2270,540],"parameters":{"jsCode":"// Get the email result from previous node\nconst emailResult = $(\u0027Snovio: Get Email Result\u0027).first().json;\nconst prospect = $(\u0027Loop Prospects\u0027).first().json;\nconst accessToken = prospect.accessToken;\n\n// Helper to encode form data\nfunction encodeForm(obj) {\n  return Object.keys(obj)\n    .map(k =\u003e encodeURIComponent(k) + \u0027=\u0027 + encodeURIComponent(obj[k]))\n    .join(\u0027\u0026\u0027);\n}\n\nlet email = null;\nlet emailStatus = \u0027not_found\u0027;\nlet confidence = 0;\n\n// Handle errors from previous steps\nif (emailResult.error) {\n  return [{\n    json: {\n      ...prospect,\n      email: null,\n      emailStatus: \u0027error\u0027,\n      emailError: emailResult.error,\n      confidence: 0\n    }\n  }];\n}\n\n// Handle different response formats based on lookup method\nif (emailResult.lookupMethod === \u0027cached\u0027) {\n  // Email was already cached from Snovio - extract from emails array or direct field\n  if (emailResult.emails \u0026\u0026 emailResult.emails.length \u003e 0) {\n    const emailData = emailResult.emails[0];\n    email = emailData.email;\n    emailStatus = emailData.emailStatus || \u0027valid\u0027;\n    confidence = 100; // Cached emails are verified\n  } else if (emailResult.email) {\n    email = emailResult.email;\n    emailStatus = \u0027valid\u0027;\n    confidence = 100;\n  }\n  \n} else if (emailResult.lookupMethod === \u0027emailLookupUrl\u0027) {\n  // Format from emailLookupUrl method\n  const data = emailResult.data || emailResult;\n  \n  if (data.emails \u0026\u0026 data.emails.length \u003e 0) {\n    const emailData = data.emails[0];\n    email = emailData.email;\n    emailStatus = emailData.status || \u0027found\u0027;\n    confidence = emailData.probability || 0;\n  } else if (data.status === \u0027in_progress\u0027) {\n    emailStatus = \u0027in_progress\u0027;\n  }\n  \n} else if (emailResult.lookupMethod === \u0027emailFinder\u0027) {\n  // Format from Email Finder API (get-emails-from-names)\n  const data = emailResult.data || emailResult;\n  \n  // Check various places for email\n  if (data.emails \u0026\u0026 data.emails.length \u003e 0) {\n    const emailData = data.emails[0];\n    email = emailData.email;\n    emailStatus = emailData.status || \u0027found\u0027;\n    confidence = emailData.probability || 0;\n  } else if (data.email) {\n    // Direct email field\n    email = data.email;\n    emailStatus = data.emailStatus || \u0027found\u0027;\n    confidence = data.accuracy || 0;\n  } else if (emailResult.email) {\n    // Email at top level of result\n    email = emailResult.email;\n    emailStatus = \u0027found\u0027;\n    confidence = emailResult.accuracy || 0;\n  }\n  \n  // If no email found and still in_progress, poll one more time\n  if (!email \u0026\u0026 (data.status === \u0027in_progress\u0027 || emailResult.sent === true)) {\n    try {\n      // Wait 2 seconds and retry\n      await new Promise(resolve =\u003e setTimeout(resolve, 2000));\n      \n      const { firstName, lastName, domain } = emailResult;\n      const formBody = encodeForm({\n        access_token: accessToken,\n        first_name: firstName,\n        last_name: lastName,\n        domain: domain\n      });\n      \n      const retryResponse = await this.helpers.httpRequest({\n        method: \u0027POST\u0027,\n        url: \u0027https://api.snov.io/v1/get-emails-from-names\u0027,\n        headers: { \u0027Content-Type\u0027: \u0027application/x-www-form-urlencoded\u0027 },\n        body: formBody\n      });\n      \n      const retryData = retryResponse.data || retryResponse;\n      if (retryData.emails \u0026\u0026 retryData.emails.length \u003e 0) {\n        const emailData = retryData.emails[0];\n        email = emailData.email;\n        emailStatus = emailData.status || \u0027found\u0027;\n        confidence = emailData.probability || 0;\n      } else if (retryResponse.email) {\n        email = retryResponse.email;\n        emailStatus = \u0027found\u0027;\n        confidence = retryResponse.accuracy || 0;\n      }\n    } catch (e) {\n      // Ignore retry errors\n    }\n  }\n}\n\nreturn [{\n  json: {\n    ...prospect,\n    email,\n    emailStatus,\n    confidence,\n    lookupMethod: emailResult.lookupMethod\n  }\n}];"}},{"id":"create-zoho-contact","name":"Create Zoho Contact","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2490,540],"parameters":{"method":"POST","url":"https://www.zohoapis.com/crm/v2/Contacts","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ data: [{ First_Name: $json.firstName || \u0027\u0027, Last_Name: $json.lastName || \u0027Unknown\u0027, Email: $json.email || null, Title: $json.position || null, Phone: $json.companyPhone || null, LinkedIn_Contact_Profile_URL: $json.linkedin || null, Website: $json.linkedin || null, Account_Name: { id: $json.accountId }, Lead_Source: \u0027Snov.io\u0027, Lead_Source_Perdigon: \u0027Snovio\u0027, Enriched_Source: \u0027Snovio\u0027, Snov_io_ID: $json.id || $json.prospectHash || null }], trigger: [\u0027workflow\u0027] }) }}","options":{"response":{"response":{"responseFormat":"json"}}}},"credentials":{"zohoOAuth2Api":{"id":"jcm850uJVwpPyj2c","name":"Zoho ALL account"}},"onError":"continueRegularOutput","alwaysOutputData":true},{"id":"contact-created-check","name":"Contact Created?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2380,540],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.data?.[0]?.code }}","rightValue":"SUCCESS","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}}},{"id":"add-unverified-tag","name":"Add Unverified Tag","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2750,660],"parameters":{"method":"POST","url":"=https://www.zohoapis.com/crm/v2/Contacts/{{ $json.data[0].details.id }}/actions/add_tags?tag_names=Email%20Unverified","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","options":{}},"credentials":{"zohoOAuth2Api":{"id":"jcm850uJVwpPyj2c","name":"Zoho ALL account"}},"onError":"continueRegularOutput"},{"id":"log-contact-result","name":"Log Contact Result","type":"n8n-nodes-base.code","typeVersion":2,"position":[2820,540],"parameters":{"jsCode":"const createResult = $(\u0027Create Zoho Contact\u0027).first().json;\nconst prospectData = $(\u0027Parse Email Result\u0027).first().json;\n\nconst success = createResult.data?.[0]?.code === \u0027SUCCESS\u0027;\nconst contactId = createResult.data?.[0]?.details?.id || null;\n\nreturn [{ json: {\n  success,\n  contactId,\n  name: `${prospectData.firstName} ${prospectData.lastName}`,\n  email: prospectData.email,\n  isVerified: prospectData.isVerified,\n  error: success ? null : (createResult.data?.[0]?.message || \u0027Unknown error\u0027)\n}}];"}},{"id":"collect-results","name":"Collect Results","type":"n8n-nodes-base.code","typeVersion":2,"position":[3040,540],"parameters":{"jsCode":"const allResults = $input.all().map(i =\u003e i.json);\nconst config = $(\u0027Config (Save)\u0027).first().json;\n\nconst successful = allResults.filter(r =\u003e r.success);\nconst failed = allResults.filter(r =\u003e !r.success);\n\nreturn [{ json: {\n  accountName: config.ACCOUNT_NAME,\n  totalSelected: config.SELECTED_PROSPECTS.length,\n  totalCreated: successful.length,\n  totalFailed: failed.length,\n  created: successful,\n  failed: failed,\n  logoUrl: config.LOGO_URL\n}}];"}},{"id":"respond-save-success","name":"Respond: Save Success","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[3260,540],"parameters":{"respondWith":"text","responseBody":"=\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eImport Complete\u003c/title\u003e\u003cstyle\u003ebody{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#1a1a2e;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0}.card{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:24px;padding:40px;text-align:center;max-width:500px}.icon{font-size:72px;margin-bottom:16px}h1{color:#4ade80;margin:0 0 8px}.stat{font-size:48px;font-weight:700;background:linear-gradient(135deg,#4ade80,#22d3ee);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.label{color:#64748b;font-size:14px;text-transform:uppercase}.subtitle{color:#94a3b8;margin-top:8px}.countdown{color:#64748b;font-size:13px;margin-top:24px}.manual-close{display:none;margin-top:16px}.manual-close a{color:#60a5fa;text-decoration:none;font-size:14px}.manual-close a:hover{text-decoration:underline}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"icon\"\u003eâœ“\u003c/div\u003e\u003ch1\u003eImport Complete\u003c/h1\u003e\u003cdiv class=\"subtitle\"\u003e{{ $json.accountName }}\u003c/div\u003e\u003cdiv style=\"margin:24px 0\"\u003e\u003cdiv class=\"stat\"\u003e{{ $json.totalCreated }}\u003c/div\u003e\u003cdiv class=\"label\"\u003eContacts Created\u003c/div\u003e\u003c/div\u003e{{ $json.totalFailed \u003e 0 ? \u0027\u003cdiv style=\"color:#fbbf24;font-size:14px;\"\u003e\u0027 + $json.totalFailed + \u0027 failed (duplicates or errors)\u003c/div\u003e\u0027 : \u0027\u0027 }}\u003cdiv class=\"countdown\"\u003eClosing in \u003cspan id=\"t\"\u003e5\u003c/span\u003es...\u003c/div\u003e\u003cdiv class=\"manual-close\" id=\"manualClose\"\u003e\u003ca href=\"#\" onclick=\"tryClose();return false;\"\u003eClick here to close\u003c/a\u003e or close this tab manually\u003c/div\u003e\u003c/div\u003e\u003cscript\u003e(function(){var c=5;var countdownEl=document.getElementById(\u0027t\u0027);var manualEl=document.getElementById(\u0027manualClose\u0027);var timer=setInterval(function(){c--;countdownEl.textContent=c;if(c\u003c=0){clearInterval(timer);tryClose();}},1000);function tryClose(){try{window.close();}catch(e){}setTimeout(function(){try{self.close();}catch(e){}},100);setTimeout(function(){try{open(location,\u0027_self\u0027).close();}catch(e){}},200);setTimeout(function(){countdownEl.parentElement.innerHTML=\u0027You can close this window now\u0027;manualEl.style.display=\u0027block\u0027;},500);}window.tryClose=tryClose;})();\u003c/script\u003e\u003c/body\u003e\u003c/html\u003e","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"respond-save-error","name":"Respond: Save Error","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1060,720],"parameters":{"respondWith":"text","responseBody":"=\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eError\u003c/title\u003e\u003cstyle\u003ebody{font-family:sans-serif;background:#1a1a2e;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}.card{background:rgba(255,255,255,0.1);border-radius:20px;padding:40px;text-align:center;max-width:500px}.icon{font-size:64px;margin-bottom:20px}h1{color:#f87171}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"icon\"\u003eâš ï¸\u003c/div\u003e\u003ch1\u003eImport Error\u003c/h1\u003e\u003cp\u003e{{ $(\u0027Config (Save)\u0027).first().json.error || \u0027Missing data or no prospects selected\u0027 }}\u003c/p\u003e\u003c/div\u003e\u003c/body\u003e\u003c/html\u003e","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"wait-for-results","name":"Wait 3s","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2160,180],"parameters":{"amount":3,"unit":"seconds"}},{"id":"snovio-get-results","name":"Snovio: Get Results","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2380,180],"parameters":{"url":"={{ $(\u0027Snovio: Start Search\u0027).first().json.links.result }}","method":"GET","options":{"response":{"response":{"responseFormat":"json"}}},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $(\u0027Snovio: Get Token\u0027).first().json.access_token }}"}]}}},{"id":"wait-email-lookup","name":"Wait Email Lookup","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1830,540],"parameters":{"amount":2,"unit":"seconds"}},{"id":"snovio-get-email","name":"Snovio: Get Email Result","type":"n8n-nodes-base.code","typeVersion":2,"position":[2050,540],"parameters":{"jsCode":"// Get the lookup result from previous node\nconst lookupResult = $(\u0027Snovio: Start Email Lookup\u0027).first().json;\nconst prospect = $(\u0027Loop Prospects\u0027).first().json;\nconst accessToken = prospect.accessToken;\n\n// Check which lookup method was used\nif (lookupResult.lookupMethod === \u0027cached\u0027) {\n  // Email was already cached - just pass through the data\n  return [{ json: { \n    ...lookupResult,\n    emails: [{ email: lookupResult.email, emailStatus: \u0027valid\u0027 }]\n  } }];\n  \n} else if (lookupResult.lookupMethod === \u0027emailLookupUrl\u0027) {\n  // Use the result URL from the original lookup\n  const resultUrl = lookupResult.links?.result;\n  if (!resultUrl) {\n    return [{ json: { ...lookupResult, error: \u0027No result URL available\u0027 } }];\n  }\n  \n  try {\n    const response = await this.helpers.httpRequest({\n      method: \u0027GET\u0027,\n      url: resultUrl,\n      headers: {\n        \u0027Authorization\u0027: `Bearer ${accessToken}`\n      }\n    });\n    return [{ json: { ...response, lookupMethod: \u0027emailLookupUrl\u0027 } }];\n  } catch (error) {\n    return [{ json: { error: error.message, lookupMethod: \u0027emailLookupUrl\u0027 } }];\n  }\n  \n} else if (lookupResult.lookupMethod === \u0027emailFinder\u0027) {\n  // Use Snovio get-emails-from-names API\n  const { firstName, lastName, domain } = lookupResult;\n  \n  // Must manually encode as form-urlencoded string\n  try {\n    const formBody = `access_token=${encodeURIComponent(accessToken)}\u0026first_name=${encodeURIComponent(firstName)}\u0026last_name=${encodeURIComponent(lastName)}\u0026domain=${encodeURIComponent(domain)}`;\n    \n    const response = await this.helpers.httpRequest({\n      method: \u0027POST\u0027,\n      url: \u0027https://api.snov.io/v1/get-emails-from-names\u0027,\n      headers: {\n        \u0027Content-Type\u0027: \u0027application/x-www-form-urlencoded\u0027\n      },\n      body: formBody\n    });\n    \n    // Parse the response if it\u0027s a string\n    let parsed = response;\n    if (typeof response === \u0027string\u0027) {\n      try {\n        parsed = JSON.parse(response);\n      } catch (e) {\n        // Keep as string if not valid JSON\n      }\n    }\n    \n    return [{ json: { ...parsed, lookupMethod: \u0027emailFinder\u0027, firstName, lastName, domain } }];\n  } catch (error) {\n    return [{ json: { error: error.message, lookupMethod: \u0027emailFinder\u0027 } }];\n  }\n  \n} else {\n  // Unknown lookup method, pass through\n  return [{ json: { ...lookupResult, error: \u0027Unknown lookup method\u0027 } }];\n}"}},{"id":"is-verified-check","name":"Is Verified?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2550,540],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"verified-condition","leftValue":"={{ $json.isVerified }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}}},{"id":"add-verified-tag","name":"Add Verified Tag","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2750,420],"parameters":{"method":"POST","url":"=https://www.zohoapis.com/crm/v2/Contacts/{{ $json.contactId }}/actions/add_tags?tag_names=Email%20Verified","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","options":{}}},{"id":"snovio-get-balance","name":"Snovio: Get Balance","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1830,180],"parameters":{"method":"GET","url":"https://api.snov.io/v1/get-balance","authentication":"none","sendQuery":true,"specifyQuery":"keypair","queryParameters":{"parameters":[{"name":"access_token","value":"={{ $json.access_token }}"}]},"sendHeaders":false,"sendBody":false,"options":{}}}],"connections":{"Webhook: Search":{"main":[[{"node":"Config (Search)","type":"main","index":0}]]},"Webhook: Save":{"main":[[{"node":"Config (Save)","type":"main","index":0}]]},"Config (Search)":{"main":[[{"node":"Has Account ID?","type":"main","index":0}]]},"Config (Save)":{"main":[[{"node":"Has Save Data?","type":"main","index":0}]]},"Has Account ID?":{"main":[[{"node":"Get Zoho Account","type":"main","index":0}],[{"node":"Respond: Error","type":"main","index":0}]]},"Get Zoho Account":{"main":[[{"node":"Parse Account","type":"main","index":0}]]},"Parse Account":{"main":[[{"node":"Has Domain?","type":"main","index":0}]]},"Has Domain?":{"main":[[{"node":"Snovio: Get Token","type":"main","index":0}],[{"node":"Respond: No Domain","type":"main","index":0}]]},"Parse Snovio Results":{"main":[[{"node":"Has Account Updates?","type":"main","index":0}]]},"Has Account Updates?":{"main":[[{"node":"Update Zoho Account","type":"main","index":0}],[{"node":"Merge to Popup","type":"main","index":1}]]},"Update Zoho Account":{"main":[[{"node":"Merge to Popup","type":"main","index":0}]]},"Merge to Popup":{"main":[[{"node":"Build Popup HTML","type":"main","index":0}]]},"Build Popup HTML":{"main":[[{"node":"Respond: Popup","type":"main","index":0}]]},"Has Save Data?":{"main":[[{"node":"Snovio: Get Token (Save)","type":"main","index":0}],[{"node":"Respond: Save Error","type":"main","index":0}]]},"Snovio: Get Token (Save)":{"main":[[{"node":"Prepare Prospects","type":"main","index":0}]]},"Prepare Prospects":{"main":[[{"node":"Loop Prospects","type":"main","index":0}]]},"Loop Prospects":{"main":[[{"node":"Collect Results","type":"main","index":0}],[{"node":"Snovio: Start Email Lookup","type":"main","index":0}]]},"Parse Email Result":{"main":[[{"node":"Create Zoho Contact","type":"main","index":0}]]},"Create Zoho Contact":{"main":[[{"node":"Contact Created?","type":"main","index":0}]]},"Contact Created?":{"main":[[{"node":"Is Verified?","type":"main","index":0}],[{"node":"Log Contact Result","type":"main","index":0}]]},"Add Unverified Tag":{"main":[[{"node":"Log Contact Result","type":"main","index":0}]]},"Log Contact Result":{"main":[[{"node":"Loop Prospects","type":"main","index":0}]]},"Collect Results":{"main":[[{"node":"Respond: Save Success","type":"main","index":0}]]},"Snovio: Start Search":{"main":[[{"node":"Wait 3s","type":"main","index":0}]]},"Wait 3s":{"main":[[{"node":"Snovio: Get Results","type":"main","index":0}]]},"Snovio: Get Results":{"main":[[{"node":"Parse Snovio Results","type":"main","index":0}]]},"Snovio: Start Email Lookup":{"main":[[{"node":"Wait Email Lookup","type":"main","index":0}]]},"Wait Email Lookup":{"main":[[{"node":"Snovio: Get Email Result","type":"main","index":0}]]},"Snovio: Get Email Result":{"main":[[{"node":"Parse Email Result","type":"main","index":0}]]},"Is Verified?":{"main":[[{"node":"Add Verified Tag","type":"main","index":0}],[{"node":"Add Unverified Tag","type":"main","index":0}]]},"Add Verified Tag":{"main":[[{"node":"Log Contact Result","type":"main","index":0}]]},"Snovio: Get Token":{"main":[[{"node":"Snovio: Get Balance","type":"main","index":0}]]},"Snovio: Get Balance":{"main":[[{"node":"Snovio: Start Search","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":true,"timeSavedMode":"fixed"},"staticData":null,"meta":null,"pinData":null,"versionId":"af6bb115-588a-404d-b16f-77604b3c0579","activeVersionId":"af6bb115-588a-404d-b16f-77604b3c0579","versionCounter":155,"triggerCount":2,"shared":[{"updatedAt":"2026-01-10T18:22:25.856Z","createdAt":"2026-01-10T18:22:25.856Z","role":"workflow:owner","workflowId":"pvdUlL8oUiLlSvkD","projectId":"N52xeAo1hMPPT2P4","project":{"updatedAt":"2025-11-13T21:33:12.830Z","createdAt":"2025-11-13T21:27:50.981Z","id":"N52xeAo1hMPPT2P4","name":"Mike Allen \u003cmike.allen@perdigon-group.com\u003e","type":"personal","icon":null,"description":null,"creatorId":"4fe16f81-4e05-4ba3-a58c-2970e1ede8e2","projectRelations":[{"updatedAt":"2025-11-13T21:27:50.981Z","createdAt":"2025-11-13T21:27:50.981Z","userId":"4fe16f81-4e05-4ba3-a58c-2970e1ede8e2","projectId":"N52xeAo1hMPPT2P4","user":{"updatedAt":"2026-01-11T22:05:22.000Z","createdAt":"2025-11-13T21:27:50.390Z","id":"4fe16f81-4e05-4ba3-a58c-2970e1ede8e2","email":"mike.allen@perdigon-group.com","firstName":"Mike","lastName":"Allen","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-11-13T21:33:59.435Z","personalization_survey_n8n_version":"1.119.1","companyType":"personal","reportedSource":"other","reportedSourceOther":"NETWORK CHUCK"},"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"Jlve26MM1bo0tkBq","userActivatedAt":1763099359849,"npsSurvey":{"responded":true,"lastShownAt":1763500436856}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2026-01-11","isPending":false}}]}}],"tags":[],"activeVersion":{"updatedAt":"2026-01-12T05:25:50.793Z","createdAt":"2026-01-12T05:25:50.793Z","versionId":"af6bb115-588a-404d-b16f-77604b3c0579","workflowId":"pvdUlL8oUiLlSvkD","nodes":[{"id":"sticky-overview","name":"Overview","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"parameters":{"content":"## Snovio Contact Finder\n\n**Endpoints:**\n- GET /snovio-search?accountId=XXX\n- POST /snovio-save\n\n**Flow:**\n1. Get Account â†’ Extract domain\n2. Snovio Domain Search (1 credit)\n3. Auto-update Account fields\n4. Display prospect popup\n5. User selects contacts\n6. Email lookup (1 credit each)\n7. Create Zoho Contacts\n\n**Branding:** Perdigon dark theme","height":400,"width":300,"color":4}},{"id":"webhook-search","name":"Webhook: Search","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[400,300],"webhookId":"snovio-search","parameters":{"httpMethod":"GET","path":"snovio-search","responseMode":"responseNode","options":{}}},{"id":"webhook-save","name":"Webhook: Save","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[400,600],"webhookId":"snovio-save","parameters":{"httpMethod":"POST","path":"snovio-save","responseMode":"responseNode","options":{}}},{"id":"config-search","name":"Config (Search)","type":"n8n-nodes-base.code","typeVersion":2,"position":[620,300],"parameters":{"jsCode":"const query = $input.first().json.query || {};\n\nconst CONFIG = {\n  SNOVIO_USER_ID: \u0027d37f94b18ce02ece5f401ce8683b258e\u0027,\n  SNOVIO_SECRET: \u002745b473e4d2f48e928c9bafd7fcbcd853\u0027,\n  ACCOUNT_ID: query.accountId || null,\n  LOGO_URL: \u0027https://raw.githubusercontent.com/mallen012/Perdigon-Directory/main/Blue%20Logo%20Only.png\u0027\n};\n\nif (!CONFIG.ACCOUNT_ID) {\n  return [{ json: { error: \u0027Missing accountId parameter\u0027, CONFIG } }];\n}\n\nreturn [{ json: CONFIG }];"}},{"id":"config-save","name":"Config (Save)","type":"n8n-nodes-base.code","typeVersion":2,"position":[620,600],"parameters":{"jsCode":"const body = $input.first().json.body || {};\n\nconst CONFIG = {\n  SNOVIO_USER_ID: \u0027d37f94b18ce02ece5f401ce8683b258e\u0027,\n  SNOVIO_SECRET: \u002745b473e4d2f48e928c9bafd7fcbcd853\u0027,\n  ACCOUNT_ID: body.accountId || null,\n  ACCOUNT_NAME: body.accountName || \u0027\u0027,\n  DOMAIN: body.domain || \u0027\u0027,\n  SELECTED_PROSPECTS: body.prospects || [],\n  LOGO_URL: \u0027https://raw.githubusercontent.com/mallen012/Perdigon-Directory/main/Blue%20Logo%20Only.png\u0027\n};\n\nif (!CONFIG.ACCOUNT_ID || CONFIG.SELECTED_PROSPECTS.length === 0) {\n  return [{ json: { error: \u0027Missing accountId or no prospects selected\u0027, CONFIG } }];\n}\n\nreturn [{ json: CONFIG }];"}},{"id":"check-account-id","name":"Has Account ID?","type":"n8n-nodes-base.if","typeVersion":2,"position":[840,300],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.ACCOUNT_ID }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}}},{"id":"get-zoho-account","name":"Get Zoho Account","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1060,240],"parameters":{"url":"=https://www.zohoapis.com/crm/v2/Accounts/{{ $json.ACCOUNT_ID }}","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","options":{}},"credentials":{"zohoOAuth2Api":{"id":"jcm850uJVwpPyj2c","name":"Zoho ALL account"}}},{"id":"parse-account","name":"Parse Account","type":"n8n-nodes-base.code","typeVersion":2,"position":[1280,240],"parameters":{"jsCode":"const response = $input.first().json;\nconst config = $(\u0027Config (Search)\u0027).first().json;\n\nconst account = response.data?.[0];\nif (!account) {\n  return [{ json: { error: \u0027Account not found\u0027, accountId: config.ACCOUNT_ID } }];\n}\n\n// Extract domain from website\nlet domain = null;\nif (account.Website) {\n  try {\n    let url = account.Website;\n    if (!url.startsWith(\u0027http\u0027)) url = \u0027https://\u0027 + url;\n    domain = new URL(url).hostname.replace(\u0027www.\u0027, \u0027\u0027);\n  } catch (e) {\n    // Try simple extraction\n    domain = account.Website.replace(/^(https?:\\/\\/)?(www\\.)?/, \u0027\u0027).split(\u0027/\u0027)[0];\n  }\n}\n\nreturn [{ json: {\n  ...config,\n  accountId: account.id,\n  accountName: account.Account_Name || \u0027\u0027,\n  website: account.Website || null,\n  domain: domain,\n  currentPhone: account.Phone || null,\n  currentIndustry: account.Industry || null,\n  currentEmployees: account.No_of_Employees || null,\n  currentStreet: account.Billing_Street || null,\n  currentCity: account.Billing_City || null,\n  currentState: account.Billing_State || null,\n  currentZip: account.Billing_Code || null,\n  currentCountry: account.Billing_Country || null\n}}];"}},{"id":"check-domain","name":"Has Domain?","type":"n8n-nodes-base.if","typeVersion":2,"position":[1500,240],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.domain }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}}},{"id":"snovio-token","name":"Snovio: Get Token","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1720,180],"parameters":{"method":"POST","url":"https://api.snov.io/v1/oauth/access_token","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ grant_type: \u0027client_credentials\u0027, client_id: $json.SNOVIO_USER_ID, client_secret: $json.SNOVIO_SECRET }) }}","options":{"response":{"response":{"responseFormat":"json"}}}}},{"id":"snovio-domain-search","name":"Snovio: Start Search","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1940,180],"parameters":{"url":"https://api.snov.io/v2/domain-search/prospects/start","method":"POST","sendBody":true,"sendHeaders":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ domain: $(\u0027Parse Account\u0027).first().json.domain }) }}","headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $(\u0027Snovio: Get Token\u0027).first().json.access_token }}"}]},"options":{"response":{"response":{"responseFormat":"json"}}}},"onError":"continueRegularOutput","alwaysOutputData":true},{"id":"parse-snovio-results","name":"Parse Snovio Results","type":"n8n-nodes-base.code","typeVersion":2,"position":[2600,180],"parameters":{"jsCode":"const snovio = $input.first().json;\nconst accountData = $(\u0027Parse Account\u0027).first().json;\n\n// Get credits balance from Snovio: Get Balance node\nconst creditsData = $(\u0027Snovio: Get Balance\u0027).first().json;\nconst creditsBalance = creditsData.balance || 0;\n\n// v2 API response: data[] is the array of prospects, meta.total_count is the total\nconst rawProspects = snovio.data || [];\nconst totalCount = snovio.meta?.total_count || rawProspects.length;\n\nconst prospects = rawProspects.map((p, idx) =\u003e {\n  // Check if Snovio already has cached email for this prospect\n  const cachedEmail = p.emails?.emails?.[0]?.email || null;\n  const cachedStatus = p.emails?.emails?.[0]?.smtp_status || null;\n  \n  // Extract prospect hash from search_emails_start URL (if present)\n  const emailUrl = p.search_emails_start || \u0027\u0027;\n  const hashMatch = emailUrl.match(/start\\/([a-f0-9]+)$/);\n  const prospectHash = hashMatch ? hashMatch[1] : null;\n  \n  // Determine email and status\n  let email = null;\n  let status = \u0027unknown\u0027;\n  \n  if (cachedEmail) {\n    // Snovio already has the email cached - use it directly\n    email = cachedEmail;\n    status = cachedStatus || \u0027valid\u0027;\n  } else if (p.email) {\n    // Direct email field (legacy format)\n    email = p.email;\n    status = \u0027valid\u0027;\n  }\n  \n  return {\n    id: prospectHash || `prospect-${idx}`,\n    firstName: p.first_name || \u0027\u0027,\n    lastName: p.last_name || \u0027\u0027,\n    fullName: `${p.first_name || \u0027\u0027} ${p.last_name || \u0027\u0027}`.trim() || \u0027Unknown\u0027,\n    position: p.position || \u0027\u0027,\n    email: email,\n    sourcePage: p.source_page || null,\n    status: status,\n    prospectHash: prospectHash,\n    emailLookupUrl: p.search_emails_start || null,\n    hasCachedEmail: !!cachedEmail\n  };\n});\n\n// Company info from Snovio meta\nconst meta = snovio.meta || {};\nconst companyInfo = {\n  companyName: meta.company_name || null,\n  website: accountData.domain,\n  logoUrl: meta.logo || null,\n  phone: meta.hq_phone || null,\n  industry: meta.industry || null,\n  city: meta.city || null,\n  state: meta.state || null,\n  country: meta.country || null,\n  street: meta.street || null,\n  postalCode: meta.postal_code || null,\n  employeeCount: meta.employee_count || null\n};\n\n// Build update fields for Account (only if currently empty in Zoho)\nconst accountUpdates = {};\n\n// Phone\nif (!accountData.currentPhone \u0026\u0026 meta.hq_phone) {\n  accountUpdates.Phone = meta.hq_phone;\n}\n\n// Industry\nif (!accountData.currentIndustry \u0026\u0026 meta.industry) {\n  accountUpdates.Industry = meta.industry;\n}\n\n// Billing Address fields\nif (!accountData.currentStreet \u0026\u0026 meta.street) {\n  accountUpdates.Billing_Street = meta.street;\n}\nif (!accountData.currentCity \u0026\u0026 meta.city) {\n  accountUpdates.Billing_City = meta.city;\n}\nif (!accountData.currentState \u0026\u0026 meta.state) {\n  accountUpdates.Billing_State = meta.state;\n}\nif (!accountData.currentZip \u0026\u0026 meta.postal_code) {\n  accountUpdates.Billing_Code = meta.postal_code;\n}\nif (!accountData.currentCountry \u0026\u0026 meta.country) {\n  accountUpdates.Billing_Country = meta.country;\n}\n\n// Employee count\nif (!accountData.currentEmployees \u0026\u0026 meta.employee_count) {\n  accountUpdates.Employees = meta.employee_count;\n}\n\nreturn [{ json: {\n  ...accountData,\n  companyInfo,\n  prospects,\n  prospectCount: prospects.length,\n  totalCount: totalCount,\n  hasMorePages: !!snovio.links?.next,\n  accountUpdates,\n  hasUpdates: Object.keys(accountUpdates).length \u003e 0,\n  apiSuccess: snovio.status === \u0027completed\u0027 || rawProspects.length \u003e 0,\n  creditsBalance: creditsBalance\n}}];"}},{"id":"check-updates","name":"Has Account Updates?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2820,180],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.hasUpdates }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}}},{"id":"update-zoho-account","name":"Update Zoho Account","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3040,120],"parameters":{"method":"PUT","url":"=https://www.zohoapis.com/crm/v2/Accounts/{{ $json.accountId }}","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ data: [$json.accountUpdates] }) }}","options":{}},"credentials":{"zohoOAuth2Api":{"id":"jcm850uJVwpPyj2c","name":"Zoho ALL account"}},"onError":"continueRegularOutput"},{"id":"merge-to-popup","name":"Merge to Popup","type":"n8n-nodes-base.merge","typeVersion":3,"position":[3260,180],"parameters":{"mode":"append"}},{"id":"build-popup-html","name":"Build Popup HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[3480,180],"parameters":{"jsCode":"const data = $(\u0027Parse Snovio Results\u0027).first().json;\nconst prospects = data.prospects || [];\nconst accountName = data.accountName || \u0027Account\u0027;\nconst domain = data.domain || \u0027\u0027;\nconst logoUrl = data.LOGO_URL;\nconst totalInDb = data.totalCount || 0;\nconst creditsBalance = data.creditsBalance || 0;\n\nlet rows = \u0027\u0027;\nif (prospects.length === 0) {\n  rows = \u0027\u003ctr\u003e\u003ctd colspan=\"5\" style=\"text-align:center;padding:40px;color:#94a3b8;\"\u003e\u0027 +\n    (totalInDb \u003e 0 ? \u0027\u003cdiv style=\"font-size:48px;margin-bottom:16px;\"\u003eðŸ“Š\u003c/div\u003e\u003cdiv style=\"font-size:18px;margin-bottom:8px;\"\u003e\u0027 + totalInDb + \u0027 emails in Snovio database\u003c/div\u003e\u003cdiv style=\"font-size:13px;\"\u003eProspect data is being processed. Try again in a moment.\u003c/div\u003e\u0027 : \u0027No contacts found for this domain\u0027) +\n    \u0027\u003c/td\u003e\u003c/tr\u003e\u0027;\n} else {\n  prospects.forEach((p, i) =\u003e {\n    const hasEmail = p.email \u0026\u0026 p.email.length \u003e 0;\n    const rowBg = hasEmail ? \u0027rgba(100,200,120,0.15)\u0027 : \u0027rgba(255,180,80,0.15)\u0027;\n    const statusIcon = hasEmail ? \u0027âœ“\u0027 : \u0027?\u0027;\n    const statusColor = hasEmail ? \u0027#4ade80\u0027 : \u0027#fbbf24\u0027;\n    const linkedInLink = p.sourcePage \n      ? \u0027\u003ca href=\"\u0027 + p.sourcePage + \u0027\" target=\"_blank\" style=\"color:#60a5fa;text-decoration:none;\"\u003eLinkedIn â†—\u003c/a\u003e\u0027\n      : \u0027\u003cspan style=\"color:#64748b;\"\u003eâ€”\u003c/span\u003e\u0027;\n    \n    rows += \u0027\u003ctr style=\"background:\u0027 + rowBg + \u0027;\"\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;text-align:center;\"\u003e\u0027 +\n        \u0027\u003cinput type=\"checkbox\" name=\"prospect\" value=\"\u0027 + p.id + \u0027\" \u0027 +\n          \u0027data-firstname=\"\u0027 + (p.firstName || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-lastname=\"\u0027 + (p.lastName || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-position=\"\u0027 + (p.position || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-email=\"\u0027 + (p.email || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-linkedin=\"\u0027 + (p.sourcePage || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027data-status=\"\u0027 + p.status + \u0027\" \u0027 +\n          \u0027data-hash=\"\u0027 + (p.prospectHash || \u0027\u0027) + \u0027\" \u0027 +\n          \u0027data-emaillookupurl=\"\u0027 + (p.emailLookupUrl || \u0027\u0027).replace(/\"/g, \u0027\u0026quot;\u0027) + \u0027\" \u0027 +\n          \u0027style=\"width:18px;height:18px;cursor:pointer;\"\u003e\u0027 +\n      \u0027\u003c/td\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;\"\u003e\u0027 +\n        \u0027\u003cdiv style=\"font-weight:500;\"\u003e\u0027 + p.fullName + \u0027\u003c/div\u003e\u0027 +\n        (p.email ? \u0027\u003cdiv style=\"font-size:12px;color:#94a3b8;\"\u003e\u0027 + p.email + \u0027\u003c/div\u003e\u0027 : \u0027\u003cdiv style=\"font-size:12px;color:#fbbf24;\"\u003eEmail lookup required\u003c/div\u003e\u0027) +\n      \u0027\u003c/td\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;\"\u003e\u0027 + linkedInLink + \u0027\u003c/td\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;color:#cbd5e1;\"\u003e\u0027 + (p.position || \u0027â€”\u0027) + \u0027\u003c/td\u003e\u0027 +\n      \u0027\u003ctd style=\"padding:12px;text-align:center;\"\u003e\u003cspan style=\"color:\u0027 + statusColor + \u0027;font-weight:bold;\"\u003e\u0027 + statusIcon + \u0027\u003c/span\u003e\u003c/td\u003e\u0027 +\n      \u0027\u003c/tr\u003e\u0027;\n  });\n}\n\nconst html = \u0027\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eSnovio Contact Finder\u003c/title\u003e\u003cstyle\u003e*{box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#1a1a2e;color:#fff;margin:0;padding:20px;min-height:100vh}.container{max-width:900px;margin:0 auto}.header{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid rgba(255,255,255,0.1)}.logo{height:40px}.header-content{flex:1}.title{font-size:24px;font-weight:600}.subtitle{color:#94a3b8;font-size:14px;margin-top:4px}.header-badges{display:flex;gap:10px;align-items:center}.credits-badge{background:linear-gradient(135deg,#10b981,#059669);padding:8px 16px;border-radius:20px;font-size:13px;font-weight:600}.db-count{background:linear-gradient(135deg,#6366f1,#8b5cf6);padding:8px 16px;border-radius:20px;font-size:13px;font-weight:600}.card{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:16px;overflow:hidden}.table-container{overflow-x:auto;max-height:500px;overflow-y:auto}table{width:100%;border-collapse:collapse}th{background:rgba(0,0,0,0.3);padding:14px 12px;text-align:left;font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;color:#94a3b8;position:sticky;top:0;z-index:10}th:first-child{text-align:center;width:50px}th:last-child{text-align:center;width:60px}tr{border-bottom:1px solid rgba(255,255,255,0.05)}tr:hover{background:rgba(255,255,255,0.05)!important}.footer{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:rgba(0,0,0,0.2)}.count{color:#94a3b8;font-size:14px}.btn{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s}.btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(99,102,241,0.4)}.btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}.legend{display:flex;gap:20px;margin-top:16px;font-size:13px;color:#94a3b8}.legend-item{display:flex;align-items:center;gap:6px}.legend-dot{width:12px;height:12px;border-radius:3px}.legend-verified{background:rgba(100,200,120,0.4)}.legend-unverified{background:rgba(255,180,80,0.4)}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"container\"\u003e\u003cdiv class=\"header\"\u003e\u003cimg src=\"\u0027 + logoUrl + \u0027\" alt=\"Perdigon\" class=\"logo\"\u003e\u003cdiv class=\"header-content\"\u003e\u003cdiv class=\"title\"\u003eSnovio Contact Finder\u003c/div\u003e\u003cdiv class=\"subtitle\"\u003e\u0027 + accountName + \u0027 â€¢ \u0027 + domain + \u0027\u003c/div\u003e\u003c/div\u003e\u003cdiv class=\"header-badges\"\u003e\u003cdiv class=\"credits-badge\"\u003eðŸ’³ \u0027 + creditsBalance.toLocaleString() + \u0027 credits\u003c/div\u003e\u0027 + (totalInDb \u003e 0 ? \u0027\u003cdiv class=\"db-count\"\u003eðŸ“Š \u0027 + totalInDb + \u0027 in database\u003c/div\u003e\u0027 : \u0027\u0027) + \u0027\u003c/div\u003e\u003c/div\u003e\u003cform id=\"contactForm\"\u003e\u003cinput type=\"hidden\" name=\"accountId\" value=\"\u0027 + data.accountId + \u0027\"\u003e\u003cinput type=\"hidden\" name=\"accountName\" value=\"\u0027 + accountName + \u0027\"\u003e\u003cinput type=\"hidden\" name=\"domain\" value=\"\u0027 + domain + \u0027\"\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"table-container\"\u003e\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003eSelect\u003c/th\u003e\u003cth\u003eContact\u003c/th\u003e\u003cth\u003eProfile\u003c/th\u003e\u003cth\u003ePosition\u003c/th\u003e\u003cth\u003eStatus\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u0027 + rows + \u0027\u003c/tbody\u003e\u003c/table\u003e\u003c/div\u003e\u003cdiv class=\"footer\"\u003e\u003cdiv class=\"count\"\u003e\u003cspan id=\"selectedCount\"\u003e0\u003c/span\u003e of \u0027 + prospects.length + \u0027 selected\u003c/div\u003e\u003cbutton type=\"submit\" class=\"btn\" id=\"importBtn\"\u0027 + (prospects.length === 0 ? \u0027 disabled\u0027 : \u0027\u0027) + \u0027\u003eImport Selected\u003c/button\u003e\u003c/div\u003e\u003c/div\u003e\u003c/form\u003e\u003cdiv class=\"legend\"\u003e\u003cdiv class=\"legend-item\"\u003e\u003cdiv class=\"legend-dot legend-verified\"\u003e\u003c/div\u003e\u003cspan\u003eHas Email\u003c/span\u003e\u003c/div\u003e\u003cdiv class=\"legend-item\"\u003e\u003cdiv class=\"legend-dot legend-unverified\"\u003e\u003c/div\u003e\u003cspan\u003eNeeds Email Lookup (1 credit)\u003c/span\u003e\u003c/div\u003e\u003c/div\u003e\u003c/div\u003e\u003cscript\u003econst form=document.getElementById(\"contactForm\");const checkboxes=document.querySelectorAll(\"input[name=prospect]\");const countEl=document.getElementById(\"selectedCount\");const importBtn=document.getElementById(\"importBtn\");function updateCount(){const selected=document.querySelectorAll(\"input[name=prospect]:checked\").length;countEl.textContent=selected;importBtn.disabled=selected===0}checkboxes.forEach(cb=\u003ecb.addEventListener(\"change\",updateCount));form.addEventListener(\"submit\",async(e)=\u003e{e.preventDefault();importBtn.disabled=true;importBtn.textContent=\"Importing...\";const selected=[];document.querySelectorAll(\"input[name=prospect]:checked\").forEach(cb=\u003e{selected.push({id:cb.value,firstName:cb.dataset.firstname,lastName:cb.dataset.lastname,position:cb.dataset.position,email:cb.dataset.email||null,linkedin:cb.dataset.linkedin,status:cb.dataset.status,prospectHash:cb.dataset.hash,emailLookupUrl:cb.dataset.emaillookupurl})});try{const response=await fetch(\"https://n8n.srv1127126.hstgr.cloud/webhook/snovio-save\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({accountId:form.querySelector(\"[name=accountId]\").value,accountName:form.querySelector(\"[name=accountName]\").value,domain:form.querySelector(\"[name=domain]\").value,prospects:selected})});const html=await response.text();document.body.innerHTML=html}catch(err){alert(\"Error: \"+err.message);importBtn.disabled=false;importBtn.textContent=\"Import Selected\"}})\u003c/script\u003e\u003c/body\u003e\u003c/html\u003e\u0027;\n\nreturn [{ json: { html, prospectCount: prospects.length } }];"}},{"id":"respond-popup","name":"Respond: Popup","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[3700,180],"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"respond-no-domain","name":"Respond: No Domain","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1720,360],"parameters":{"respondWith":"text","responseBody":"=\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eNo Website\u003c/title\u003e\u003cstyle\u003ebody{font-family:sans-serif;background:#1a1a2e;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}.card{background:rgba(255,255,255,0.1);border-radius:20px;padding:40px;text-align:center;max-width:500px}.icon{font-size:64px;margin-bottom:20px}h1{color:#f87171}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"icon\"\u003eðŸŒ\u003c/div\u003e\u003ch1\u003eNo Website Found\u003c/h1\u003e\u003cp\u003eThis Account doesn\u0027t have a Website field populated.\u003c/p\u003e\u003cp style=\"color:#94a3b8;margin-top:20px;\"\u003eAdd a website URL to the Account, then try again.\u003c/p\u003e\u003c/div\u003e\u003c/body\u003e\u003c/html\u003e","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"respond-error","name":"Respond: Error","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[840,440],"parameters":{"respondWith":"text","responseBody":"=\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eError\u003c/title\u003e\u003cstyle\u003ebody{font-family:sans-serif;background:#1a1a2e;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}.card{background:rgba(255,255,255,0.1);border-radius:20px;padding:40px;text-align:center;max-width:500px}.icon{font-size:64px;margin-bottom:20px}h1{color:#f87171}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"icon\"\u003eâš ï¸\u003c/div\u003e\u003ch1\u003eMissing Account ID\u003c/h1\u003e\u003cp\u003eNo accountId parameter was provided.\u003c/p\u003e\u003c/div\u003e\u003c/body\u003e\u003c/html\u003e","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"check-save-data","name":"Has Save Data?","type":"n8n-nodes-base.if","typeVersion":2,"position":[840,600],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.ACCOUNT_ID }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}},{"leftValue":"={{ $json.SELECTED_PROSPECTS.length }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}}},{"id":"snovio-token-save","name":"Snovio: Get Token (Save)","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1060,540],"parameters":{"method":"POST","url":"https://api.snov.io/v1/oauth/access_token","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ grant_type: \u0027client_credentials\u0027, client_id: $(\u0027Config (Save)\u0027).first().json.SNOVIO_USER_ID, client_secret: $(\u0027Config (Save)\u0027).first().json.SNOVIO_SECRET }) }}","options":{"response":{"response":{"responseFormat":"json"}}}}},{"id":"prepare-prospects","name":"Prepare Prospects","type":"n8n-nodes-base.code","typeVersion":2,"position":[1280,540],"parameters":{"jsCode":"const config = $(\u0027Config (Save)\u0027).first().json;\nconst token = $input.first().json.access_token;\n\nreturn config.SELECTED_PROSPECTS.map(p =\u003e ({\n  json: {\n    ...p,\n    accountId: config.ACCOUNT_ID,\n    accountName: config.ACCOUNT_NAME,\n    domain: config.DOMAIN,\n    accessToken: token\n  }\n}));"}},{"id":"loop-prospects","name":"Loop Prospects","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1500,540],"parameters":{"options":{}}},{"id":"snovio-email-finder","name":"Snovio: Start Email Lookup","type":"n8n-nodes-base.code","typeVersion":2,"position":[1720,540],"parameters":{"jsCode":"// Get prospect data from Loop Prospects\nconst prospect = $input.first().json;\nconst { firstName, lastName, domain, emailLookupUrl, accessToken, email } = prospect;\n\n// FIRST: Check if we already have a valid email (from Snovio cached data)\nif (email \u0026\u0026 email !== null \u0026\u0026 email.includes(\u0027@\u0027)) {\n  // Email already exists - pass it through without any API call\n  return [{ \n    json: { \n      ...prospect,\n      lookupMethod: \u0027cached\u0027,\n      email: email,\n      status: \u0027valid\u0027\n    } \n  }];\n}\n\n// Check if we have a valid emailLookupUrl\nif (emailLookupUrl \u0026\u0026 emailLookupUrl.startsWith(\u0027http\u0027)) {\n  // Use the existing emailLookupUrl (from domain search)\n  try {\n    const response = await this.helpers.httpRequest({\n      method: \u0027POST\u0027,\n      url: emailLookupUrl,\n      headers: {\n        \u0027Authorization\u0027: `Bearer ${accessToken}`,\n        \u0027Content-Type\u0027: \u0027application/json\u0027\n      }\n    });\n    return [{ json: { ...response, lookupMethod: \u0027emailLookupUrl\u0027 } }];\n  } catch (error) {\n    return [{ json: { error: error.message, lookupMethod: \u0027emailLookupUrl\u0027 } }];\n  }\n} else {\n  // Use Snovio Email Finder API (add-names-to-find-emails)\n  // Must manually encode as form-urlencoded string\n  try {\n    const formBody = `access_token=${encodeURIComponent(accessToken)}\u0026first_name=${encodeURIComponent(firstName)}\u0026last_name=${encodeURIComponent(lastName)}\u0026domain=${encodeURIComponent(domain)}`;\n    \n    const response = await this.helpers.httpRequest({\n      method: \u0027POST\u0027,\n      url: \u0027https://api.snov.io/v1/add-names-to-find-emails\u0027,\n      headers: {\n        \u0027Content-Type\u0027: \u0027application/x-www-form-urlencoded\u0027\n      },\n      body: formBody\n    });\n    \n    // Parse the response if it\u0027s a string\n    let parsed = response;\n    if (typeof response === \u0027string\u0027) {\n      try {\n        parsed = JSON.parse(response);\n      } catch (e) {\n        // Keep as string if not valid JSON\n      }\n    }\n    \n    // Return with metadata for next step\n    return [{ \n      json: { \n        ...parsed,\n        lookupMethod: \u0027emailFinder\u0027,\n        firstName,\n        lastName,\n        domain,\n        accessToken\n      } \n    }];\n  } catch (error) {\n    return [{ json: { error: error.message, lookupMethod: \u0027emailFinder\u0027 } }];\n  }\n}"},"onError":"continueRegularOutput","alwaysOutputData":true},{"id":"parse-email-result","name":"Parse Email Result","type":"n8n-nodes-base.code","typeVersion":2,"position":[2270,540],"parameters":{"jsCode":"// Get the email result from previous node\nconst emailResult = $(\u0027Snovio: Get Email Result\u0027).first().json;\nconst prospect = $(\u0027Loop Prospects\u0027).first().json;\nconst accessToken = prospect.accessToken;\n\n// Helper to encode form data\nfunction encodeForm(obj) {\n  return Object.keys(obj)\n    .map(k =\u003e encodeURIComponent(k) + \u0027=\u0027 + encodeURIComponent(obj[k]))\n    .join(\u0027\u0026\u0027);\n}\n\nlet email = null;\nlet emailStatus = \u0027not_found\u0027;\nlet confidence = 0;\n\n// Handle errors from previous steps\nif (emailResult.error) {\n  return [{\n    json: {\n      ...prospect,\n      email: null,\n      emailStatus: \u0027error\u0027,\n      emailError: emailResult.error,\n      confidence: 0\n    }\n  }];\n}\n\n// Handle different response formats based on lookup method\nif (emailResult.lookupMethod === \u0027cached\u0027) {\n  // Email was already cached from Snovio - extract from emails array or direct field\n  if (emailResult.emails \u0026\u0026 emailResult.emails.length \u003e 0) {\n    const emailData = emailResult.emails[0];\n    email = emailData.email;\n    emailStatus = emailData.emailStatus || \u0027valid\u0027;\n    confidence = 100; // Cached emails are verified\n  } else if (emailResult.email) {\n    email = emailResult.email;\n    emailStatus = \u0027valid\u0027;\n    confidence = 100;\n  }\n  \n} else if (emailResult.lookupMethod === \u0027emailLookupUrl\u0027) {\n  // Format from emailLookupUrl method\n  const data = emailResult.data || emailResult;\n  \n  if (data.emails \u0026\u0026 data.emails.length \u003e 0) {\n    const emailData = data.emails[0];\n    email = emailData.email;\n    emailStatus = emailData.status || \u0027found\u0027;\n    confidence = emailData.probability || 0;\n  } else if (data.status === \u0027in_progress\u0027) {\n    emailStatus = \u0027in_progress\u0027;\n  }\n  \n} else if (emailResult.lookupMethod === \u0027emailFinder\u0027) {\n  // Format from Email Finder API (get-emails-from-names)\n  const data = emailResult.data || emailResult;\n  \n  // Check various places for email\n  if (data.emails \u0026\u0026 data.emails.length \u003e 0) {\n    const emailData = data.emails[0];\n    email = emailData.email;\n    emailStatus = emailData.status || \u0027found\u0027;\n    confidence = emailData.probability || 0;\n  } else if (data.email) {\n    // Direct email field\n    email = data.email;\n    emailStatus = data.emailStatus || \u0027found\u0027;\n    confidence = data.accuracy || 0;\n  } else if (emailResult.email) {\n    // Email at top level of result\n    email = emailResult.email;\n    emailStatus = \u0027found\u0027;\n    confidence = emailResult.accuracy || 0;\n  }\n  \n  // If no email found and still in_progress, poll one more time\n  if (!email \u0026\u0026 (data.status === \u0027in_progress\u0027 || emailResult.sent === true)) {\n    try {\n      // Wait 2 seconds and retry\n      await new Promise(resolve =\u003e setTimeout(resolve, 2000));\n      \n      const { firstName, lastName, domain } = emailResult;\n      const formBody = encodeForm({\n        access_token: accessToken,\n        first_name: firstName,\n        last_name: lastName,\n        domain: domain\n      });\n      \n      const retryResponse = await this.helpers.httpRequest({\n        method: \u0027POST\u0027,\n        url: \u0027https://api.snov.io/v1/get-emails-from-names\u0027,\n        headers: { \u0027Content-Type\u0027: \u0027application/x-www-form-urlencoded\u0027 },\n        body: formBody\n      });\n      \n      const retryData = retryResponse.data || retryResponse;\n      if (retryData.emails \u0026\u0026 retryData.emails.length \u003e 0) {\n        const emailData = retryData.emails[0];\n        email = emailData.email;\n        emailStatus = emailData.status || \u0027found\u0027;\n        confidence = emailData.probability || 0;\n      } else if (retryResponse.email) {\n        email = retryResponse.email;\n        emailStatus = \u0027found\u0027;\n        confidence = retryResponse.accuracy || 0;\n      }\n    } catch (e) {\n      // Ignore retry errors\n    }\n  }\n}\n\nreturn [{\n  json: {\n    ...prospect,\n    email,\n    emailStatus,\n    confidence,\n    lookupMethod: emailResult.lookupMethod\n  }\n}];"}},{"id":"create-zoho-contact","name":"Create Zoho Contact","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2490,540],"parameters":{"method":"POST","url":"https://www.zohoapis.com/crm/v2/Contacts","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify({ data: [{ First_Name: $json.firstName || \u0027\u0027, Last_Name: $json.lastName || \u0027Unknown\u0027, Email: $json.email || null, Title: $json.position || null, LinkedIn_Contact_Profile_URL: $json.linkedin || null, Account_Name: { id: $json.accountId }, Lead_Source_Perdigon: \u0027Snovio\u0027, Enriched_Source: \u0027Snovio\u0027 }], trigger: [\u0027workflow\u0027] }) }}","options":{"response":{"response":{"responseFormat":"json"}}}},"credentials":{"zohoOAuth2Api":{"id":"jcm850uJVwpPyj2c","name":"Zoho ALL account"}},"onError":"continueRegularOutput","alwaysOutputData":true},{"id":"contact-created-check","name":"Contact Created?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2380,540],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.data?.[0]?.code }}","rightValue":"SUCCESS","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}}},{"id":"add-unverified-tag","name":"Add Unverified Tag","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2750,660],"parameters":{"method":"POST","url":"=https://www.zohoapis.com/crm/v2/Contacts/{{ $json.data[0].details.id }}/actions/add_tags?tag_names=Email%20Unverified","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","options":{}},"credentials":{"zohoOAuth2Api":{"id":"jcm850uJVwpPyj2c","name":"Zoho ALL account"}},"onError":"continueRegularOutput"},{"id":"log-contact-result","name":"Log Contact Result","type":"n8n-nodes-base.code","typeVersion":2,"position":[2820,540],"parameters":{"jsCode":"const createResult = $(\u0027Create Zoho Contact\u0027).first().json;\nconst prospectData = $(\u0027Parse Email Result\u0027).first().json;\n\nconst success = createResult.data?.[0]?.code === \u0027SUCCESS\u0027;\nconst contactId = createResult.data?.[0]?.details?.id || null;\n\nreturn [{ json: {\n  success,\n  contactId,\n  name: `${prospectData.firstName} ${prospectData.lastName}`,\n  email: prospectData.email,\n  isVerified: prospectData.isVerified,\n  error: success ? null : (createResult.data?.[0]?.message || \u0027Unknown error\u0027)\n}}];"}},{"id":"collect-results","name":"Collect Results","type":"n8n-nodes-base.code","typeVersion":2,"position":[3040,540],"parameters":{"jsCode":"const allResults = $input.all().map(i =\u003e i.json);\nconst config = $(\u0027Config (Save)\u0027).first().json;\n\nconst successful = allResults.filter(r =\u003e r.success);\nconst failed = allResults.filter(r =\u003e !r.success);\n\nreturn [{ json: {\n  accountName: config.ACCOUNT_NAME,\n  totalSelected: config.SELECTED_PROSPECTS.length,\n  totalCreated: successful.length,\n  totalFailed: failed.length,\n  created: successful,\n  failed: failed,\n  logoUrl: config.LOGO_URL\n}}];"}},{"id":"respond-save-success","name":"Respond: Save Success","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[3260,540],"parameters":{"respondWith":"text","responseBody":"=\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eImport Complete\u003c/title\u003e\u003cstyle\u003ebody{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#1a1a2e;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0}.card{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:24px;padding:40px;text-align:center;max-width:500px}.icon{font-size:72px;margin-bottom:16px}h1{color:#4ade80;margin:0 0 8px}.stat{font-size:48px;font-weight:700;background:linear-gradient(135deg,#4ade80,#22d3ee);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.label{color:#64748b;font-size:14px;text-transform:uppercase}.subtitle{color:#94a3b8;margin-top:8px}.countdown{color:#64748b;font-size:13px;margin-top:24px}.manual-close{display:none;margin-top:16px}.manual-close a{color:#60a5fa;text-decoration:none;font-size:14px}.manual-close a:hover{text-decoration:underline}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"icon\"\u003eâœ“\u003c/div\u003e\u003ch1\u003eImport Complete\u003c/h1\u003e\u003cdiv class=\"subtitle\"\u003e{{ $json.accountName }}\u003c/div\u003e\u003cdiv style=\"margin:24px 0\"\u003e\u003cdiv class=\"stat\"\u003e{{ $json.totalCreated }}\u003c/div\u003e\u003cdiv class=\"label\"\u003eContacts Created\u003c/div\u003e\u003c/div\u003e{{ $json.totalFailed \u003e 0 ? \u0027\u003cdiv style=\"color:#fbbf24;font-size:14px;\"\u003e\u0027 + $json.totalFailed + \u0027 failed (duplicates or errors)\u003c/div\u003e\u0027 : \u0027\u0027 }}\u003cdiv class=\"countdown\"\u003eClosing in \u003cspan id=\"t\"\u003e5\u003c/span\u003es...\u003c/div\u003e\u003cdiv class=\"manual-close\" id=\"manualClose\"\u003e\u003ca href=\"#\" onclick=\"tryClose();return false;\"\u003eClick here to close\u003c/a\u003e or close this tab manually\u003c/div\u003e\u003c/div\u003e\u003cscript\u003e(function(){var c=5;var countdownEl=document.getElementById(\u0027t\u0027);var manualEl=document.getElementById(\u0027manualClose\u0027);var timer=setInterval(function(){c--;countdownEl.textContent=c;if(c\u003c=0){clearInterval(timer);tryClose();}},1000);function tryClose(){try{window.close();}catch(e){}setTimeout(function(){try{self.close();}catch(e){}},100);setTimeout(function(){try{open(location,\u0027_self\u0027).close();}catch(e){}},200);setTimeout(function(){countdownEl.parentElement.innerHTML=\u0027You can close this window now\u0027;manualEl.style.display=\u0027block\u0027;},500);}window.tryClose=tryClose;})();\u003c/script\u003e\u003c/body\u003e\u003c/html\u003e","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"respond-save-error","name":"Respond: Save Error","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1060,720],"parameters":{"respondWith":"text","responseBody":"=\u003c!DOCTYPE html\u003e\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eError\u003c/title\u003e\u003cstyle\u003ebody{font-family:sans-serif;background:#1a1a2e;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}.card{background:rgba(255,255,255,0.1);border-radius:20px;padding:40px;text-align:center;max-width:500px}.icon{font-size:64px;margin-bottom:20px}h1{color:#f87171}\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"card\"\u003e\u003cdiv class=\"icon\"\u003eâš ï¸\u003c/div\u003e\u003ch1\u003eImport Error\u003c/h1\u003e\u003cp\u003e{{ $(\u0027Config (Save)\u0027).first().json.error || \u0027Missing data or no prospects selected\u0027 }}\u003c/p\u003e\u003c/div\u003e\u003c/body\u003e\u003c/html\u003e","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html"}]}}}},{"id":"wait-for-results","name":"Wait 3s","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2160,180],"parameters":{"amount":3,"unit":"seconds"}},{"id":"snovio-get-results","name":"Snovio: Get Results","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2380,180],"parameters":{"url":"={{ $(\u0027Snovio: Start Search\u0027).first().json.links.result }}","method":"GET","options":{"response":{"response":{"responseFormat":"json"}}},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $(\u0027Snovio: Get Token\u0027).first().json.access_token }}"}]}}},{"id":"wait-email-lookup","name":"Wait Email Lookup","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1830,540],"parameters":{"amount":2,"unit":"seconds"}},{"id":"snovio-get-email","name":"Snovio: Get Email Result","type":"n8n-nodes-base.code","typeVersion":2,"position":[2050,540],"parameters":{"jsCode":"// Get the lookup result from previous node\nconst lookupResult = $(\u0027Snovio: Start Email Lookup\u0027).first().json;\nconst prospect = $(\u0027Loop Prospects\u0027).first().json;\nconst accessToken = prospect.accessToken;\n\n// Check which lookup method was used\nif (lookupResult.lookupMethod === \u0027cached\u0027) {\n  // Email was already cached - just pass through the data\n  return [{ json: { \n    ...lookupResult,\n    emails: [{ email: lookupResult.email, emailStatus: \u0027valid\u0027 }]\n  } }];\n  \n} else if (lookupResult.lookupMethod === \u0027emailLookupUrl\u0027) {\n  // Use the result URL from the original lookup\n  const resultUrl = lookupResult.links?.result;\n  if (!resultUrl) {\n    return [{ json: { ...lookupResult, error: \u0027No result URL available\u0027 } }];\n  }\n  \n  try {\n    const response = await this.helpers.httpRequest({\n      method: \u0027GET\u0027,\n      url: resultUrl,\n      headers: {\n        \u0027Authorization\u0027: `Bearer ${accessToken}`\n      }\n    });\n    return [{ json: { ...response, lookupMethod: \u0027emailLookupUrl\u0027 } }];\n  } catch (error) {\n    return [{ json: { error: error.message, lookupMethod: \u0027emailLookupUrl\u0027 } }];\n  }\n  \n} else if (lookupResult.lookupMethod === \u0027emailFinder\u0027) {\n  // Use Snovio get-emails-from-names API\n  const { firstName, lastName, domain } = lookupResult;\n  \n  // Must manually encode as form-urlencoded string\n  try {\n    const formBody = `access_token=${encodeURIComponent(accessToken)}\u0026first_name=${encodeURIComponent(firstName)}\u0026last_name=${encodeURIComponent(lastName)}\u0026domain=${encodeURIComponent(domain)}`;\n    \n    const response = await this.helpers.httpRequest({\n      method: \u0027POST\u0027,\n      url: \u0027https://api.snov.io/v1/get-emails-from-names\u0027,\n      headers: {\n        \u0027Content-Type\u0027: \u0027application/x-www-form-urlencoded\u0027\n      },\n      body: formBody\n    });\n    \n    // Parse the response if it\u0027s a string\n    let parsed = response;\n    if (typeof response === \u0027string\u0027) {\n      try {\n        parsed = JSON.parse(response);\n      } catch (e) {\n        // Keep as string if not valid JSON\n      }\n    }\n    \n    return [{ json: { ...parsed, lookupMethod: \u0027emailFinder\u0027, firstName, lastName, domain } }];\n  } catch (error) {\n    return [{ json: { error: error.message, lookupMethod: \u0027emailFinder\u0027 } }];\n  }\n  \n} else {\n  // Unknown lookup method, pass through\n  return [{ json: { ...lookupResult, error: \u0027Unknown lookup method\u0027 } }];\n}"}},{"id":"is-verified-check","name":"Is Verified?","type":"n8n-nodes-base.if","typeVersion":2,"position":[2550,540],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"verified-condition","leftValue":"={{ $json.isVerified }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}}},{"id":"add-verified-tag","name":"Add Verified Tag","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2750,420],"parameters":{"method":"POST","url":"=https://www.zohoapis.com/crm/v2/Contacts/{{ $json.contactId }}/actions/add_tags?tag_names=Email%20Verified","authentication":"predefinedCredentialType","nodeCredentialType":"zohoOAuth2Api","options":{}}},{"id":"snovio-get-balance","name":"Snovio: Get Balance","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1830,180],"parameters":{"method":"GET","url":"https://api.snov.io/v1/get-balance","authentication":"none","sendQuery":true,"specifyQuery":"keypair","queryParameters":{"parameters":[{"name":"access_token","value":"={{ $json.access_token }}"}]},"sendHeaders":false,"sendBody":false,"options":{}}}],"connections":{"Webhook: Search":{"main":[[{"node":"Config (Search)","type":"main","index":0}]]},"Webhook: Save":{"main":[[{"node":"Config (Save)","type":"main","index":0}]]},"Config (Search)":{"main":[[{"node":"Has Account ID?","type":"main","index":0}]]},"Config (Save)":{"main":[[{"node":"Has Save Data?","type":"main","index":0}]]},"Has Account ID?":{"main":[[{"node":"Get Zoho Account","type":"main","index":0}],[{"node":"Respond: Error","type":"main","index":0}]]},"Get Zoho Account":{"main":[[{"node":"Parse Account","type":"main","index":0}]]},"Parse Account":{"main":[[{"node":"Has Domain?","type":"main","index":0}]]},"Has Domain?":{"main":[[{"node":"Snovio: Get Token","type":"main","index":0}],[{"node":"Respond: No Domain","type":"main","index":0}]]},"Parse Snovio Results":{"main":[[{"node":"Has Account Updates?","type":"main","index":0}]]},"Has Account Updates?":{"main":[[{"node":"Update Zoho Account","type":"main","index":0}],[{"node":"Merge to Popup","type":"main","index":1}]]},"Update Zoho Account":{"main":[[{"node":"Merge to Popup","type":"main","index":0}]]},"Merge to Popup":{"main":[[{"node":"Build Popup HTML","type":"main","index":0}]]},"Build Popup HTML":{"main":[[{"node":"Respond: Popup","type":"main","index":0}]]},"Has Save Data?":{"main":[[{"node":"Snovio: Get Token (Save)","type":"main","index":0}],[{"node":"Respond: Save Error","type":"main","index":0}]]},"Snovio: Get Token (Save)":{"main":[[{"node":"Prepare Prospects","type":"main","index":0}]]},"Prepare Prospects":{"main":[[{"node":"Loop Prospects","type":"main","index":0}]]},"Loop Prospects":{"main":[[{"node":"Collect Results","type":"main","index":0}],[{"node":"Snovio: Start Email Lookup","type":"main","index":0}]]},"Parse Email Result":{"main":[[{"node":"Create Zoho Contact","type":"main","index":0}]]},"Create Zoho Contact":{"main":[[{"node":"Contact Created?","type":"main","index":0}]]},"Contact Created?":{"main":[[{"node":"Is Verified?","type":"main","index":0}],[{"node":"Log Contact Result","type":"main","index":0}]]},"Add Unverified Tag":{"main":[[{"node":"Log Contact Result","type":"main","index":0}]]},"Log Contact Result":{"main":[[{"node":"Loop Prospects","type":"main","index":0}]]},"Collect Results":{"main":[[{"node":"Respond: Save Success","type":"main","index":0}]]},"Snovio: Start Search":{"main":[[{"node":"Wait 3s","type":"main","index":0}]]},"Wait 3s":{"main":[[{"node":"Snovio: Get Results","type":"main","index":0}]]},"Snovio: Get Results":{"main":[[{"node":"Parse Snovio Results","type":"main","index":0}]]},"Snovio: Start Email Lookup":{"main":[[{"node":"Wait Email Lookup","type":"main","index":0}]]},"Wait Email Lookup":{"main":[[{"node":"Snovio: Get Email Result","type":"main","index":0}]]},"Snovio: Get Email Result":{"main":[[{"node":"Parse Email Result","type":"main","index":0}]]},"Is Verified?":{"main":[[{"node":"Add Verified Tag","type":"main","index":0}],[{"node":"Add Unverified Tag","type":"main","index":0}]]},"Add Verified Tag":{"main":[[{"node":"Log Contact Result","type":"main","index":0}]]},"Snovio: Get Token":{"main":[[{"node":"Snovio: Get Balance","type":"main","index":0}]]},"Snovio: Get Balance":{"main":[[{"node":"Snovio: Start Search","type":"main","index":0}]]}},"authors":"Mike Allen","name":null,"description":null,"autosaved":false,"workflowPublishHistory":[{"createdAt":"2026-01-12T05:25:50.856Z","id":593,"workflowId":"pvdUlL8oUiLlSvkD","versionId":"af6bb115-588a-404d-b16f-77604b3c0579","event":"activated","userId":"4fe16f81-4e05-4ba3-a58c-2970e1ede8e2"}]}}
